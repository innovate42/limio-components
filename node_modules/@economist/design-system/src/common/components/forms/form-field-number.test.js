import React from 'react';
import { mount, shallow } from 'enzyme';
import FormInput from './form-input';
import FormFieldNumber from './form-field-number';

const handleOnChange = jest.fn();

describe('<FormFieldNumber />', () => {
  it('should pass default props to the FormInput component', () => {
    const component = shallow(
      <FormFieldNumber helperText='Form helper text' labelText='Form label' />,
    );
    const formInput = component.find(FormInput);
    expect(formInput.props().disabled).toEqual(false);
    expect(formInput.props().onBlur).toEqual(null);
    expect(formInput.props().onChange).toEqual(null);
    expect(formInput.props().placeholder).toEqual(null);
    expect(formInput.props().id).toEqual('');
    expect(formInput.props().name).toEqual('');
    expect(formInput.props().value).toEqual('');
  });

  it('should pass props to a FormInput component', () => {
    const handleOnBlur = jest.fn();

    const component = shallow(
      <FormFieldNumber
        disabled
        error='Error message'
        id='123'
        labelText='Form label'
        onBlur={handleOnBlur}
        onChange={handleOnChange}
        placeholder='Placeholder text'
        max='100'
        min='-100'
        slim
        step='5'
        name='Field name'
        value='Text value'
      />,
    );
    const formInput = component.find(FormInput);
    expect(formInput.props().disabled).toBeDefined();
    expect(formInput.props().error).toEqual('Error message');
    expect(formInput.props().id).toEqual('123');
    expect(formInput.props().onBlur).toEqual(handleOnBlur);
    expect(formInput.props().onChange).toEqual(handleOnChange);
    expect(formInput.props().placeholder).toEqual('Placeholder text');
    expect(formInput.props().name).toEqual('Field name');
    expect(formInput.props().value).toEqual('Text value');
    expect(formInput.props().max).toEqual('100');
    expect(formInput.props().min).toEqual('-100');
    expect(formInput.props().slim).toEqual(true);
    expect(formInput.props().step).toEqual('5');
  });

  it('should pass props to the FormLabel component', () => {
    const component = shallow(
      <FormFieldNumber id='123' labelTag='FORM TAG' labelText='Form label' />,
    );
    const label = component.find('FormLabel');
    expect(label.props().htmlFor).toEqual('123');
    expect(label.props().text).toEqual('Form label');
    expect(label.props().tag).toEqual('FORM TAG');
  });

  it('should pass helper text prop to the FormHelperText component', () => {
    const component = shallow(
      <FormFieldNumber helperText='Form helper text' labelText='Form label' />,
    );
    expect(component.find('FormHelperText').props().text).toEqual(
      'Form helper text',
    );
  });

  describe('validation', () => {
    it('should render an FormInput an error prop', () => {
      const component = shallow(
        <FormFieldNumber error='Inline text notice' labelText='Form label' />,
      );
      expect(component.find(FormInput).props().error).toEqual(
        'Inline text notice',
      );
    });

    it('should render a FormNotice component with error text', () => {
      const component = shallow(
        <FormFieldNumber error='Inline text notice' labelText='Form label' />,
      );
      const notice = component.find('FormNotice');
      expect(notice.props().text).toEqual('Inline text notice');
    });
  });
  it('should render a slim className when passed the slim prop', () => {
    const component = shallow(<FormFieldNumber slim labelText='Form label' />);
    expect(
      component
        .find('div')
        .last()
        .props().className,
    ).toEqual('ds-form-field-number ds-form-field-number--slim');
  });
  describe('up and down buttons', () => {
    it('should increment the value on the FormInput by 1 when clicking the up button', () => {
      const component = mount(
        <FormFieldNumber
          onChange={handleOnChange}
          error='Inline text notice'
          labelText='Form label'
        />,
      );
      const buttonUp = component.find('[aria-label="Increase number"]');
      buttonUp.simulate('click');
      const formInput = component.find(FormInput);
      expect(formInput.getElement().ref.current.value).toEqual('1');
    });
    it('should increment the value on the FormInput by 2 when clicking the up button twice', () => {
      const component = mount(
        <FormFieldNumber
          onChange={handleOnChange}
          error='Inline text notice'
          labelText='Form label'
        />,
      );
      const buttonUp = component.find('[aria-label="Increase number"]');
      buttonUp.simulate('click');
      buttonUp.simulate('click');
      const formInput = component.find(FormInput);
      expect(formInput.getElement().ref.current.value).toEqual('2');
    });
    it('should decrement the value on the FormInput by 1 when clicking the down button', () => {
      const component = mount(
        <FormFieldNumber
          onChange={handleOnChange}
          error='Inline text notice'
          labelText='Form label'
        />,
      );
      const buttonUp = component.find('[aria-label="Decrease number"]');
      buttonUp.simulate('click');
      const formInput = component.find(FormInput);
      expect(formInput.getElement().ref.current.value).toEqual('-1');
    });
    it('should decrement the value on the FormInput by 2 when clicking the down button twice', () => {
      const component = mount(
        <FormFieldNumber
          onChange={handleOnChange}
          error='Inline text notice'
          labelText='Form label'
        />,
      );
      const buttonUp = component.find('[aria-label="Decrease number"]');
      buttonUp.simulate('click');
      buttonUp.simulate('click');
      const formInput = component.find(FormInput);
      expect(formInput.getElement().ref.current.value).toEqual('-2');
    });
    it('should increment the value on the FormInput by the step value when clicking the up button', () => {
      const component = mount(
        <FormFieldNumber
          step='5'
          onChange={handleOnChange}
          error='Inline text notice'
          labelText='Form label'
        />,
      );
      const buttonUp = component.find('[aria-label="Increase number"]');
      buttonUp.simulate('click');
      const formInput = component.find(FormInput);
      expect(formInput.getElement().ref.current.value).toEqual('5');
    });
    it('should decrement the value on the FormInput by the step value when clicking the down button', () => {
      const component = mount(
        <FormFieldNumber
          step='5'
          onChange={handleOnChange}
          error='Inline text notice'
          labelText='Form label'
        />,
      );
      const buttonUp = component.find('[aria-label="Decrease number"]');
      buttonUp.simulate('click');
      const formInput = component.find(FormInput);
      expect(formInput.getElement().ref.current.value).toEqual('-5');
    });
    it('should not increment the value on the FormInput over the max value when clicking the up button', () => {
      const component = mount(
        <FormFieldNumber
          step='5'
          max='9'
          onChange={handleOnChange}
          error='Inline text notice'
          labelText='Form label'
        />,
      );
      const buttonUp = component.find('[aria-label="Increase number"]');
      buttonUp.simulate('click');
      buttonUp.simulate('click');
      const formInput = component.find(FormInput);
      expect(formInput.getElement().ref.current.value).toEqual('5');
    });
    it('should not decrement the value on the FormInput below the min value when clicking the down button', () => {
      const component = mount(
        <FormFieldNumber
          step='5'
          min='-9'
          onChange={handleOnChange}
          error='Inline text notice'
          labelText='Form label'
        />,
      );
      const buttonDown = component.find('[aria-label="Decrease number"]');
      buttonDown.simulate('click');
      buttonDown.simulate('click');
      const formInput = component.find(FormInput);
      expect(formInput.getElement().ref.current.value).toEqual('-5');
    });
  });

  it("should render a container 'ds-form-field-layout ds-form-field-layout--adjacent' className when passed the adjacent prop", () => {
    const component = shallow(
      <FormFieldNumber adjacent labelText='Form label' />,
    );
    expect(
      component
        .find('div')
        .first()
        .props().className,
    ).toEqual('ds-form-field-layout ds-form-field-layout--adjacent');
  });
});
