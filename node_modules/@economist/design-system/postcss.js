const postcssConfigDefaults = require('./postcss.config.js');

module.exports = (postcssConfig = {}) => {
  const config = Object.assign(postcssConfigDefaults, postcssConfig);

  if (!config.plugins) {
    config.plugins = [];
  }

  // This logic ensures that the plugin rule to re-write CDN URLs *always* gets applied for anyone
  // using the Design System to manage their PostCSS config, even if someone has passed a custom
  // PostCSS config.
  //
  // Always adding this plugin to an existing config *could* mean that this rule gets run twice,
  // (as it must also be in `postcss.config.js`, for local builds) but that is safe to do.
  //
  // This approach reduces complexity for anyone using the Design System and is a very safe rule
  // to apply after processing any other rules. We could try to detect if this specific rule has
  // already been applied, but doing so would introduce extra complexity we don't need.
  config.plugins.push(postcssConfigDefaults._edsHelperMethods._rewriteCdnUrls);

  return config;
};
